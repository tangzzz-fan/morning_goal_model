# iOS目标记录应用 - 端侧NLP分析开发计划

## 项目概述
为iOS目标记录应用实现端侧NLP分析功能，支持模型参数一键调整、执行脚本导出模型、输出到iOS项目中运行得到模型评测结果。

## 开发里程碑

### 里程碑1：环境准备与数据收集（2周）
**状态**: 进行中

#### 已完成任务
- ✅ M1.1: 在开发机上配置Python 3.8+和PyTorch环境（已创建虚拟环境，安装PyTorch 2.9.1）

#### 待完成任务
- ⏳ M1.2: 基于开源数据集构建模拟用户目标文本库（≥10,000条）
- ⏳ M1.3: 制定详细的标注规范文档（含示例）
- ⏳ M1.4: 数据划分：训练集70%/验证集20%/测试集10%
- ⏳ M1.5: 建立数据版本控制系统（如DVC）

### 里程碑2：模型选型与预训练（3周）
**状态**: 待开始

#### 待完成任务
- ⏳ M2.1: 下载并验证bert_base_chinese预训练模型
- ⏳ M2.2: 根据任务类型修改模型输出层
- ⏳ M2.3: 冻结底层参数，仅微调最后3层
- ⏳ M2.4: 配置训练参数（batch_size=32, epochs=5-10, lr=2e-5）并实现早停机制
- ⏳ M2.5: 输出初始baseline指标（准确率/F1）

### 里程碑3：模型优化（3周）
**状态**: 待开始

#### 待完成任务
- ⏳ M3.1: 实施知识蒸馏：教师模型(bert_base_chinese) -> 学生模型(MobileBert)
- ⏳ M3.2: 模型量化：FP32→FP16(精度损失<1%)→INT8(精度损失<3%)
- ⏳ M3.3: 模型剪枝：移除20-30%低重要性参数
- ⏳ M3.4: 使用NSight分析计算热点并优化模型结构（attention头数/FFN维度）

### 里程碑4：CoreML转换（2周）
**状态**: 待开始

#### 待完成任务
- ⏳ M4.1: 使用coremltools 5.0+（ONNX opset=13）进行模型转换
- ⏳ M4.2: 验证CoreML模型（测试集精度差异<3%，输入输出格式适配）
- ⏳ M4.3: 研究并应用CoreML内置的模型压缩与优化技术
- ⏳ M4.4: 记录并优化CoreML pipeline转换流程
- ⏳ M4.5: 生成CoreML模型文件（.mlpackage）、转换日志和验证报告

### 里程碑5：iOS端侧适配（3周）
**状态**: 待开始

#### 待完成任务
- ⏳ M5.1: 创建Swift封装类（ModelWrapper）并实现后台线程推理
- ⏳ M5.2: 实现内存管理策略（按需加载模型分片）
- ⏳ M5.3: 实现增量学习数据收集机制（本地加密缓存，差分隐私同步）
- ⏳ M5.4: 验证端侧性能（单次推理<200ms，内存峰值<100MB）

### 里程碑6：部署与监控（持续迭代）
**状态**: 待开始

#### 待完成任务
- ⏳ M6.1: 建立包含完整CI/CD的TestFlight测试分发流程
- ⏳ M6.2: 实施灰度发布策略（10%→50%→100%）
- ⏳ M6.3: 建立设备端（延迟/内存/电量）和业务端（建议点击率）监控
- ⏳ M6.4: 建立崩溃报告自动收集与模型性能降级预警机制

### 开发规范与交付物
**状态**: 待开始

#### 待完成任务
- ⏳ M7.1: 严格执行Git分支与Tag规范
- ⏳ M7.2: 撰写各阶段设计文档、模型卡和问题追踪表
- ⏳ M7.3: 确保数据来源和许可协议在文档中明确声明
- ⏳ M7.4: 最终目标：实现模型参数一键调整、脚本化导出及自动化评测流程

## 技术栈调整
- **框架**: PyTorch（已确定，不使用TensorFlow）
- **模型**: bert-base-chinese → MobileBert（知识蒸馏）
- **优化**: 量化(FP32→FP16→INT8) + 剪枝 + CoreML优化
- **部署**: CoreML + iOS Swift集成

## 环境配置状态
- ✅ Python 3.13.7（满足≥3.8要求）
- ✅ PyTorch 2.9.1
- ✅ Transformers 4.57.1
- ✅ CoreML Tools 9.0
- ✅ ONNX 1.19.1 + ONNXRuntime 1.23.2
- ✅ 虚拟环境已配置（venv/）
- ✅ 项目目录结构已创建

## 下一步计划
1. 激活虚拟环境：`source activate_venv.sh`
2. 开始数据收集和标注工作
3. 制定详细的标注规范
4. 建立数据版本控制系统

## 注意事项
- 所有数据处理在设备端完成，不上传用户原始数据
- 使用开源数据集需明确声明数据来源和许可协议
- 每个里程碑完成后需进行同行评审
- 模型精度损失需控制在规定范围内（FP16<1%, INT8<3%）
- 端侧性能要求：单次推理<200ms，内存峰值<100MB

---
**文档生成时间**: 2025年11月15日  
**最后更新**: 环境配置完成，开始数据准备阶段